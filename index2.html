<html>
  <head>
    <script type="text/javascript" src="./d3.min.js"></script>
    <style type="text/css" media="screen">
      .chart rect {
        stroke: white;
        fill: steelblue;
      }
    </style>
  </head>
  <body>
    <div id="chart">
      
    </div>
    <script type="text/javascript">
      var width = 800
        ,height = 1600
    
      var chart = d3.select("#chart").append("svg")
            .attr("class", "chart")
            .attr("width", width)
            .attr("height", height)
            .append("g")
              .attr("transform", "translate(20,20)");
      
      // Header
      chart.append('rect')
        .attr("x", width - 360)
        .attr("y", 0)
        .attr("width", 350)
        .attr("height", 15)
        .attr("rx", 2)
        .attr("ry", 2)
        .style('fill', 'green')

      chart
        .append('a')
          .attr('id', 'diff')
          .attr('xlink:href', '#diff')
            .append('text')
            .attr("x", width - 350)
            .attr("y", 10)
            .text('Gap')
            .style("font-size", "8px")

      chart
        .append('a')
          .attr('id', 'category')
          .attr('xlink:href', '#category')
          .append('text')
            .attr("x", width - 300)
            .attr("y", 10)
            .text('Category')
            .style("font-size", "8px")

      chart
        .append('a')
          .attr('id', 'event')
          .attr('xlink:href', '#event')
          .append('text')
            .attr("x", width - 220)
            .attr("y", 10)
            .text('Event')
            .style("font-size", "8px")

      chart
        .append('a')
          .attr('id', 'first')
          .attr('xlink:href', '#first')
        .append('text')
          .attr("x", width - 100)
          .attr("y", 10)
          .text('Gold')
          .style("font-size", "8px")

      chart
        .append('a')
          .attr('id', 'category')
          .attr('xlink:href', '#category')
          .append('text')
            .attr("x", width - 50)
            .attr("y", 10)
            .text('hello')
            .style("font-size", "8px")
      
      d3.json("data.json", function(data) {
        Data = data
        drawChart = function(sorted){
          diffs = sorted.map(function(d){return d.diff})

           x = d3.scale.linear()
              .domain([0, d3.max(diffs)])
              .range([0, width - 10]);

           y = d3.scale.ordinal()
            .domain(diffs)
            .rangeBands([10, height]);
          
          // Facts
          group = chart.selectAll(".group")
            .data(sorted, function(d){return d.event})
          
          groupEnter = group
            .enter().append("g")
              .attr('class', 'group')
              .attr("transform", "translate(0,15)")

          var groupUpdate = group.transition().duration(1000)

          groupEnter.append('circle')
            .attr("cx", function(d){return x(d.diff)})
            .attr("cy", function(d){return y(d.diff)})
            .attr("r", 5)
            .style('fill', 'red')
          
          groupUpdate.select('circle')
            .attr("cy", function(d){return y(d.diff)})
          
          groupEnter.append('rect')
            .attr("x", width - 360)
            .attr("y", function(d){return y(d.diff) - 10})
            .attr("width", 350)
            .attr("height", 15)
            .attr("rx", 2)
            .style('fill', 'red')
          
          groupUpdate.select('rect')
            .attr("y", function(d){return y(d.diff) - 10})
          
          groupEnter.append('text')
            .attr('class', 'diff-text')
            .attr("x", width - 350)
            .attr("y", function(d){return y(d.diff)})
            .text(function(d){return d.diff.toPrecision(3) })
            .style("font-size", "8px")

          groupUpdate.select('.diff-text')
              .attr("y", function(d){return y(d.diff)})


          groupEnter.append('text')
            .attr('class', 'category-text')
            .attr("x", width - 300)
            .attr("y", function(d){return y(d.diff)})
            .text(function(d){return d.category })
            .style("font-size", "8px")

          groupUpdate.select('.category-text')
              .attr("y", function(d){return y(d.diff)})

          groupEnter.append('text')
            .attr('class', 'event-text')
            .attr("x", width - 220)
            .attr("y", function(d){return y(d.diff)})
            .text(function(d){return d.event})
            .style("font-size", "8px")
          
          groupUpdate.select('.event-text')
            .attr("y", function(d){return y(d.diff)})
          
          groupEnter.append('text')
            .attr('class', 'event-first')
            .attr("x", width - 100)
            .attr("y", function(d){return y(d.diff)})
            .text(function(d){return d.first})
            .style("font-size", "8px")
          
          groupUpdate.select('.event-first')
            .attr("y", function(d){return y(d.diff)})
            
          
          var xAxis = d3.svg.axis()
            .scale(x)
            .orient("top")
            .tickSize(1)   
            // .tickValues(data)
            // .tickFormat(d3.format(".2f"))
            // .tickPadding(1)
            // .tickSubdivide(1)
          
          group.exit().remove()
          
          chart.append("g")
            .attr("class", "x axis");
          
          d3.select(".x.axis")
            .call(xAxis);
        }
        drawChart(data)
        d3.selectAll('a')
          .on('click', function(d){ 
            var key = this.id;
            var sorted = Data.sort(function(a,b){return d3.ascending(a[key], b[key])});
            drawChart(data)
        })
          
        
      });
    </script>
  </body>
</html>
